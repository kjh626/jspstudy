<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="../resources/js/lib/jquery-3.6.4.min.js"></script>
</head>
<body>

	<div>
		<h1>시도별 실시간 측정정보 조회</h1>
		<form id="frm1">
			<select name="sidoName">	<!-- 사이트의 파라미터이름이랑 맞춰줬다. -->
				<option value="전국">전국</option>
				<option value="서울">서울</option>
				<option value="부산">부산</option>
				<option value="대구">대구</option>
				<option value="인천">인천</option>
			</select>	
			<select name="returnType" id="returnType">
				<option value="xml">XML</option>
				<option value="json">JSON</option>
			</select>
			<input type="button" id="btn1" value="조회하기">
		</form>
		<div id="content1"></div>    <!-- 결과 나타내기 위한 div -->
	</div>
	<script>
		$('#btn1').on('click', function(){
			$('#content1').empty();
			$.ajax({
				type: 'get',
				url: '/01_Servlet/AirKoreaApiServlet',
				data: $('#frm1').serialize(),
				dataType: $('#returnType').val(),  // json이나 xml
				success: (resData)=>{
					switch($('#returnType').val()){
					case "xml":
						fnXml(resData);  // 코드가 길어질 거 같아서 펑션으로 처리
						break;
					case "json":
						fnJson(resData);
						break;
					}
				}
			})  // ajax
		}) // click
		
		function fnXml(resData){
			// <item> 하나가 한 측정소를 의미. 일단 item이라는 태그를 찾아야함. => $(resData).find('item') 은 배열이다.
			// 이 아이템태그 하나를 element라고 부르면 된다.
			$.each($(resData).find('item'), (i, element)=>{
				$('#content1').append($(element).find('stationName').text() + '<br>');    // 태그를 찾고 태그 내부의 텍스트가 필요하다.
			})
			
		}
		
		function fnJson(resData){
			$.each(resData.response.body.items, (i, element)=>{
				$('#content1').append(element.stationName + '<br>');				
			})
		}
		
	</script>

</body>
</html>